<!DOCTYPE HTML> 
<html lang="en"> 
<head>
<title>PeerJS chat demo</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
<meta http-equiv="Content-Language" content="en-us"> 

<style>
  
  body {
    font-family: sans-serif;
  }

  #messages > div { margin-bottom: 8px; }

</style>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script> 
<script type="text/javascript" src="http://cdn.peerjs.com/0/peer.js"></script>
<script>
  
  var conn;
  // Connect to PeerJS, have server assign an ID instead of providing one
  var peer = new Peer({key: 'lwjd5qra8257b9', debug: true});
  peer.on('open', function(id){
    $('#pid').text(id);
  });  
  // Await connections from others
  peer.on('connection', connect);
  function connect(c) {
    $('#chat_area').show();
    conn = c;
    $('#messages').empty().append('<h2>Now chatting with ' + conn.peer +'</h2>');
    conn.on('data', function(data){
      $('#messages').append('<div><strong>' + conn.peer + ':</strong><br>' + data +'</div>');
    });
    conn.on('close', function(err){ alert(conn.peer + ' has left the chat.') });
  }
  $(document).ready(function() {
    // Conect to a peer
    $('#connect').submit(function(e){
      e.preventDefault();
      var c = peer.connect($('#rid').val());
      c.on('open', function(){
        connect(c);
      });
      c.on('error', function(err){ alert(err) });  
    });
    // Send a chat message
    $('#send').submit(function(e){
      e.preventDefault();
      var msg = $('#text').val();
      conn.send(msg);
      $('#messages').append('<div><strong>You:</strong><br>' + msg +'</div>');
      $('#text').val('');
    });
    // Show browser version
    $('#browsers').text(navigator.userAgent);
  });

</script>
</head> 
 
<body> 

  Your PeerJS id is: <strong id="pid"></strong><br>
  <form id="connect">
    <label>Connect to peer:</label>
    <input type="text" id="rid" placeholder="Someone else's id">
    <input type="submit" value="Connect">
  </form>
  
  <div id="chat_area" style="display: none;">
    <div id="messages"></div>
    <form id="send">
      <input type="text" id="text" placeholder="Enter message">
      <input type="submit" value="Send" id="send">
    </form>
  </div>
  
  <br>
  <hr>
  <p>Your browser version: <code id="browsers"></code><br>
  Currently <strong>Google Chrome 26.0.1403.0 or above</strong> is required (Dev or Canary channels)</strong><br><br>For more up to date compatibility information see <a href="http://peerjs.com/status">PeerJS WebRTC Status</a><br><br>Note that this demo may also fail if you are behind stringent firewalls or both you and the remote peer and behind symmetric NATs.</p>
  
</body> 
</html> 
